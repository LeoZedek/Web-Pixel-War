<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room</title>

    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/canva.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
</head>

<body>
    <div class="page_canva">
        <div class="cadre" id="side_menu">
            <div class="bloc_titre_1">
                <h2 class="titre_cadre">Room #1</h2>
                <p id="timer">TIMER 00:30</p>
            </div>
            <div id="color_selectors">
                <table>
                    <tr>
                        <td >
                            <div class="item_couleur" v-for="mycolor in color_ids" v-if="isValid(mycolor)">
                                <input v-model="color_ids[mycolor]" type="radio" name="select_color">
                                <label for="select_color"></label>
                                <!-- <p>{{mycolor}}</p>
                                <p>{{color_ids[mycolor - 1]}}</p>
                                <p>{{colors[mycolor]}}</p> -->
                                <span v-bind:style="{ color: colors[color_ids[mycolor - 1]].color }">⬤</span>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="bloc_titre_2">
                <h2 class="titre_cadre">Users</h2>
            </div>
            <div class="user_list">
                <div class="user_div">
                    <img src="assets/img/profile.png" class="image">
                    <p>Pseudo</p>
                </div>
                <div class="user_div">
                    <img src="assets/img/profile.png" class="image">
                    <p>Pseudo</p>
                </div>
                <div class="user_div">
                    <img src="assets/img/profile.png" class="image">
                    <p>Pseudo</p>
                </div>
                <div class="user_div">
                    <img src="assets/img/profile.png" class="image">
                    <p>Pseudo</p>
                </div>
                <div class="user_div">
                    <img src="assets/img/profile.png" class="image">
                    <p>Pseudo</p>
                </div>
            </div>
        </div>

        <div class="canva_cadre">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/vue.js"></script>

    <script vue>
        let pseudo = '<%= pseudo %>';
        let userId = '<%= userId %>'

        let address2 = window.location.search;
        let parameterList2 = new URLSearchParams(address2);
        let canvaName2 = parameterList2.get("name");

        let color_brute = [];
        const app = new Vue({
            el:"#color_selectors",
            data: {
                colors: [],
                color_ids: [],
            },
            methods: {
                isValid: function(index){
                    if (typeof this.colors[this.color_ids[index]] === "undefined"){
                        return false;
                    }
                    return true;
                }
            }  
        })
        $.ajax({
            type: 'POST',
            url: '/canva/info',
            data: {"name": canvaName2},
            async: false,
            success: function (data) {

                color_brute = data.colors;
                color_brute = color_brute.split(":0,");
                color_brute.pop();
                //Récupération des ids des couleurs
                app.color_ids = color_brute;
                //Array.from(data.colors, (element) => moduloFour(element));
                console.log("coucou");
                console.log(app.color_ids);
                //const isMultipleOf4 = (element) => element %4 === 0;
                //colors = color_brute.findIndex(isMultipleOf4);
                //console.log(colors);

            },

            error: function () {
                alert('Problème AJAX');
        }
        });
        $.ajax({
        type: 'POST',
        url: '/create_room/colors',
        success: function (received) {
            app.colors = received;
            
            //app.colors.shift();
            console.table(app.colors);
            for (index in received){
                console.log(app.colors[index].id);
                console.log(app.colors[index].color);
            }
            console.log("ALED");
            // for (i in app.color_ids){
            //     console.log("i=",i);
            //     console.log(app.colors[app.color_ids[i]].id);
            //     console.log(app.colors[app.color_ids[i]].color);
            // }
            
        },
        error: function () {
            alert('Problème AJAX');
        }
    });
    </script>
    <script src="assets/js/canvas.js"></script>
</body>

</html>